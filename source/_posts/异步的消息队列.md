---
title: 异步的消息队列
date: 2018-09-03 10:43:19
tags:
---
这是我实习期间做的一个比较大大（我个人认为而已）的项目的，虽然后来回学校所以无法继续完成这个需求，最后只能交给别人来完成了。  
### 问题： 
用户在导出我们的订单列表，商户信息生成excel的时候，数据量小的时候一切正常，但是当数据量很大的时候，等待响应的时间会特别长（十几分钟），而去最后还timeout了，这样客户即拿不到我们导出的excel，而去我们机器上还多存储了一份没有用到的excel。  
<!--more-->
### 简单的流程：
首先这是一个最简单的流程了：以导出订单为例
* 前端发起http请求（带着筛选参数，比如下单时间范围，是否已经支付）
* 后端拿到了前端发送过来的数据之后，先会判断要筛选过滤的参数是否完整，如果没问题的话就会去数据库中读取数据，再根据筛选的参数对数据进行过滤，最后格式化诗句
* 生成excel表格，然后保持在服务器上面，最后返回给前端一个下载链接
* 客户可以通过这个链接下载对应生成的excel表格  

一个简单的业务流程就是这个样子，也是在数据量比较少的时候。

### 大数据量的时候
在我们查找的数据比较大的时候，会在图中的2，3，4步会变得很缓慢，所以我们的思路是从这几个方面去解决问题

### 异步的基本模型
这是我们基本做的修改，我们打算把本来应该交给后端的完成的任务，由我们的gm_task来完成，然后直接返回给前端一个地址让客户可以去访问任务的处理进度如何。  
这样就解决了响应超时的问题了。  
### 整个异步任务的流程
